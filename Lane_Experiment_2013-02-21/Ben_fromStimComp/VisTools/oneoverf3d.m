function N = oneoverf3d(a, r, c, p)%% ONEOVERF3D - returns a volume of 1/f noise%% usage:%	ONEOVERF3D(a, n) returns a cube 3D array%	of noise with a 1/(f^a) amplitude spectum%	ONEOVERF3D(a, m, n, p) returns an m-by-n-by-p array%% see also: spike, oneoverf, spike3d%% Lawrence K. Cormack% history:% 3/30/2002     lkc     lept into the third dimension from oneoverf% 4/1/02        lkc     exponent is now handled in spike()% 4/1/02        lkc     changed the way the spectrum is generated to the more intuitive%                       amp/phase based-method, but it makes no functional difference.%*** deal with oddity *********codd = 0; rodd = 0; podd = 0;if nargin==2     c=r;    p=r;endif isodd(c)	c=c+1;	codd = 1;endif isodd(r)	r=r+1;	rodd = 1;endif isodd(p)	p=p+1;	podd = 1;end%******************************%*** get array containing 1/f^a falloff ***skirt = spike3d(a, r, c, p);	%*** make noise in f domain and scale the amplitudes%N = skirt.*(randn(r, c, p) + i.*randn(r, c, p));N = skirt.*exp(i.*2.*pi.*rand(r, c, p));	% new way of makin' bacon%*** transform to space domainN=real(ifftn(fftshift(N)));%*** normalize to 0-1 ***mn = min(min(min(N)));N = N - mn;mx = (max(max(max(N))));N=N./mx;%*** deal with oddity again ***if codd N(r,:,:) = []; endif rodd N(:,c,:) = []; endif podd N(:,:,p) = []; end%******************************% *************************************** the end